(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1045:function(t,e,n){"use strict";n.r(e);n(202),n(604),n(83);var r=[function(){var t=this._self._c;return t("span",{staticClass:"icon"},[t("img",{attrs:{src:n(448),alt:"",srcset:""}})])},function(){var t=this._self._c;return t("span",{staticClass:"icon"},[t("img",{attrs:{src:n(449),alt:"",srcset:""}})])}],c=n(1042),o=n(12),l=(n(52),n(80),n(15),n(605),n(28),n(612),n(614),n(616),n(617),n(618),n(619),n(620),n(621),n(622),n(623),n(624),n(625),n(626),n(627),n(628),n(629),n(29),n(36),n(55),n(630),n(84),n(25),n(451)),d=n(397),f=n.n(d),v=n(989),h=n(1043);var m={name:"Create",data:function(){return{campaignId:27,env:"mainnet",proxy:null,loading:!1,batch:[],repetitions:1,step:1,account:null,effectsdk:null,campaign:null,errorMessage:null,tempCounter:0,newTask:{id:null,link:null},createdBatchId:null,client:null,connectAccount:{providerName:null,provider:null,account:null},connectResponse:null,accountConnected:!1,paymentLoading:!1}},computed:{batchCost:function(){return this.batch.length*this.repetitions*this.campaign.info.reward}},watch:{campaign:function(){this.newTask=this.getEmptyTask(this.campaign.placeholders)}},created:function(){this.getCampaign(),this.campaign&&this.campaign.placeholders&&(this.newTask=this.getEmptyTask(this.campaign.placeholders))},methods:{setErrorMessage:function(t){var e=this;this.errorMessage=t,setTimeout((function(){e.errorMessage=null}),5e3)},nextStep:function(){this.errorMessage=null,this.step+=1},previousStep:function(){this.errorMessage=null,this.step-=1},getCampaign:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.effectsdk=new l.EffectClient(t.env),e.next=4,t.effectsdk.force.getCampaign(t.campaignId);case 4:t.campaign=e.sent,t.campaign&&(t.campaign.placeholders=t.getPlaceholders(t.campaign.info.template)),console.log("this.campaign",t.campaign),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),t.setErrorMessage(e.t0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},getPlaceholders:function(template){var t=function(t,e,n){n||(n=1);var r,c=[];for(;r=e.exec(t);)c.push(r[n]);return c}(template,/\$\{\s?(\w+)\s?\|?\s?(\w*)\s?\}/g);return Object(c.a)(new Set(t))},setAccount:function(t,e){this.effectsdk=e,this.account=t},createTask:function(){var t=this;this.batch.push(this.newTask),this.newTask.id=this.tempCounter++,this.newTask=this.getEmptyTask(),this.$nextTick((function(){t.$refs["placeholder-0"][0].focus()}))},getEmptyTask:function(){var t={};return this.campaign.placeholders.forEach((function(e){t[e]=""})),t},uploadBatch:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var content,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.paymentLoading=!0,e.prev=1,t.loading=!0,content={tasks:t.batch.map((function(t){return{place_holder:t.place_holder}}))},e.next=6,console.log("uploading batch",content);case 6:return e.next=8,t.client.force.createBatch(t.campaign.id,content,Number(t.repetitions),t.proxy?t.proxy:null);case 8:return n=e.sent,console.log("tx result",n),e.next=12,t.client.force.getBatchId(n.id,t.campaign.id);case 12:t.createdBatchId=e.sent,console.log("batch created with id",t.createdBatchId),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),t.setErrorMessage(e.t0),console.error(e.t0);case 20:t.loading=!1,t.paymentLoading=!1;case 22:case"end":return e.stop()}}),e,null,[[1,16]])})))()},login:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.generateClient(),e.next=4,t.connectMetamask();case 4:return e.next=6,t.connectEffectAccount();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),t.setErrorMessage(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},loginEOS:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.generateClient(),e.next=4,t.connectAnchor();case 4:return e.next=6,t.connectEffectAccount();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),t.setErrorMessage(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},generateClient:function(){console.log("Creating SDK...");try{this.client=new l.EffectClient(this.env),console.log(this.client)}catch(t){console.error(t),this.setErrorMessage(t)}},connectAnchor:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,r,c,o,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new h.a,r=new v.a({transport:n,chains:[{chainId:t.client.config.eosChainId,nodeUrl:t.client.config.eosNodeUrl}]}),e.next=5,r.login("hackathon-boilerplate");case 5:c=e.sent,o=c.session,l=o.makeSignatureProvider(),d={accountName:o.auth.actor.toString(),permission:o.auth.permission.toString()},console.log("Logged in as",d),t.connectAccount.provider=l,t.connectAccount.account=d,t.connectAccount.providerName="anchor",e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),t.setErrorMessage(e.t0),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))()},connectMetamask:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Connecting to metamask wallet."),!window.ethereum){e.next=19;break}return e.prev=2,console.log("Connecting to metamask wallet."),e.next=6,window.ethereum.request({method:"eth_requestAccounts"});case 6:return e.sent,e.next=9,window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x38"}]});case 9:t.connectAccount.provider=new f.a(window.ethereum),t.connectAccount.account=null,t.connectAccount.providerName="metamask",e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),t.setErrorMessage(e.t0);case 17:e.next=20;break;case 19:t.setErrorMessage("Metamask not installed");case 20:case"end":return e.stop()}}),e,null,[[2,14]])})))()},connectEffectAccount:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Connecting to account with wallet."),e.prev=1,!t.connectAccount.provider){e.next=8;break}return e.next=5,t.client.connectAccount(t.connectAccount.provider,t.connectAccount.account);case 5:t.connectResponse=e.sent,e.next=10;break;case 8:return t.setErrorMessage("Login failed, try again"),e.abrupt("return");case 10:t.accountConnected=!0,t.account=t.connectResponse,e.next=19;break;case 14:e.prev=14,e.t0=e.catch(1),t.accountConnected=!1,t.setErrorMessage("Login failed, try again"),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,14]])})))()}}},_=n(63),component=Object(_.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"section pt-6"},[e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-three-fifths is-offset-one-fifth"},[1===t.step?e("div",{attrs:{id:"step-1"}},[e("h2",{staticClass:"title"},[t._v("\n          Add tasks\n        ")]),t._v(" "),e("div",{staticClass:"field"},[e("div",{staticClass:"box"},[e("div",{staticClass:"p-2",staticStyle:{background:"#fff","border-radius":"8px"}},[t.campaign&&t.campaign.placeholders?e("table",{staticClass:"table mx-auto"},[e("thead",[e("tr",t._l(t.campaign.placeholders,(function(n){return e("th",{key:n,staticClass:"task-placeholder-value has-text-left"},[t._v("\n                      "+t._s(n)+"\n                    ")])})),0)]),t._v(" "),e("tbody",[t._l(t.batch,(function(n,r){return e("tr",{key:n.id},[t._l(t.campaign.placeholders,(function(n){return e("td",{key:n,staticClass:"task-placeholder-value has-text-left"},[e("span",[t._v(t._s(t.batch[r]))])])})),t._v(" "),e("td",[e("button",{staticClass:"button is-danger is-outlined is-small is-rounded",on:{click:function(e){return e.preventDefault(),t.batch.splice(r,1)}}},[t._v("\n                        X\n                      ")])])],2)})),t._v(" "),e("tr",t._l(t.campaign.placeholders,(function(n,r){return e("td",{key:n,staticClass:"task-placeholder-value"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.newTask[n],expression:"newTask[placeholder]"}],ref:"placeholder-".concat(r),refInFor:!0,staticClass:"input is-info task-placeholder-value",attrs:{type:"url",pattern:"https?://.+",placeholder:n,required:""},domProps:{value:t.newTask[n]},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createTask.apply(null,arguments))},input:function(e){e.target.composing||t.$set(t.newTask,n,e.target.value)}}})])})),0)],2)]):t._e()]),t._v(" "),e("div",{staticClass:"control has-text-centered mt-5"},[e("button",{staticClass:"button is-primary is-wide",on:{click:function(e){return e.preventDefault(),t.createTask.apply(null,arguments)}}},[t._v("\n                Add Task\n              ")])])]),t._v(" "),e("div",{staticClass:"box is-centered"},[t.campaign&&t.campaign.info?e("div",{staticClass:"is-6 py-0 px-2 batch-info"},[e("div",{staticClass:"box"},[e("span",[t._v("\n                  Amount:\n                ")]),t._v(" "),e("span",[e("strong",[t._v(t._s(t.repetitions))])]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.repetitions,expression:"repetitions"}],staticClass:"slider is-fullwidth is-info",attrs:{step:"1",min:"1",max:"20",type:"range"},domProps:{value:t.repetitions},on:{__r:function(e){t.repetitions=e.target.value}}}),t._v("\n                Total Cost\n                "),e("strong",[t._v(t._s(parseFloat(t.campaign.info.reward*t.batch.length*t.repetitions).toFixed(4))+" EFX")])])]):t._e()])]),t._v(" "),e("form",[e("div",{staticClass:"field is-grouped is-justify-content-center mt-6"},[e("div",{staticClass:"control"},[e("button",{staticClass:"button button is-primary is-wide mr-4",class:{"is-loading":t.loading},attrs:{type:"submit",disabled:!t.batch.length},on:{click:t.nextStep}},[t._v("\n                Next step\n              ")])])])])]):t._e(),t._v(" "),2===t.step?e("div",[t.accountConnected?e("h2",{staticClass:"title"},[t._v("\n          Submit to Effect Network\n        ")]):e("h2",{staticClass:"title"},[t._v("\n          Connect your wallet\n        ")]),t._v(" "),t.accountConnected?e("div",{staticClass:"box media"},[e("figure",{staticClass:"media-left"},[e("p",{staticClass:"image is-128x128"},["metamask"===t.connectAccount.providerName?e("img",{attrs:{src:n(448),alt:"",srcset:""}}):e("img",{attrs:{src:n(449),alt:"",srcset:""}})])]),t._v(" "),e("div",{staticClass:"media-content"},[e("div",{staticClass:"content"},[e("p",{staticClass:"subtitle"},[t._v("\n                Connected\n              ")]),t._v(" "),e("p",[e("strong",[t._v(t._s(t.connectResponse.accountName))])]),t._v(" "),e("hr"),t._v(" "),e("p",{staticClass:"subtitle"},[t._v("\n                Order\n              ")]),t._v(" "),e("table",{staticClass:"table is-narrow is-centered"},[e("thead"),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("Tasks")]),t._v(" "),e("td",[t._v(t._s(t.batch.length)+" ×")])]),t._v(" "),e("tr",[e("td",[t._v("Amount")]),t._v(" "),e("td",[t._v(t._s(t.repetitions)+" ×")])]),t._v(" "),e("tr",[e("td",[t._v("Cost per Task")]),t._v(" "),e("td",[e("strong",[t._v(t._s(t.campaign.info.reward))]),t._v(" "),e("i",[t._v(t._s(t.client.config.efxSymbol))])])])]),t._v(" "),e("tfoot",[e("tr",[e("td",[t._v("Total Cost")]),t._v(" "),e("td",[e("strong",[t._v(t._s(t.batchCost))]),t._v(" "),e("i",[t._v(t._s(t.client.config.efxSymbol))])])])])])])])]):t._e(),t._v(" "),t.accountConnected?t._e():e("div",{staticClass:"buttons px-6",attrs:{id:"connect-buttons"}},[e("button",{staticClass:"button is-large is-fullwidth is-light px-6 mx-6",attrs:{id:"btn-login"},on:{click:function(e){return t.login()}}},[t._m(0),t._v(" "),e("span",[t._v("Connect with BSC")])]),t._v(" "),e("button",{staticClass:"button is-large is-fullwidth is-light px-6 mx-6",attrs:{id:"btn-login-eos"},on:{click:function(e){return t.loginEOS()}}},[t._m(1),t._v(" "),e("span",[t._v("Connect with EOS")])])]),t._v(" "),t.accountConnected&&!t.createdBatchId?e("div",[t.paymentLoading?e("p",{staticClass:"notification is-warning"},[t._v("\n            Please be patient when posting...it can take up to a minute for transaction to complete.\n            "),e("br"),t._v("\n            Also note that you will need to sign multiple transactions if you are using Metamask.\n          ")]):t._e(),t._v(" "),e("form",{on:{submit:function(e){return e.preventDefault(),t.uploadBatch.apply(null,arguments)}}},[e("div",{staticClass:"field is-grouped is-justify-content-center mt-6"},[e("div",{staticClass:"control"},[e("button",{staticClass:"button is-outlined is-primary is-wide",on:{click:t.previousStep}},[t._v("\n                  Back\n                ")]),t._v(" "),e("button",{staticClass:"button button is-primary is-wide mr-4",class:{"is-loading":t.loading},attrs:{type:"submit"}},[t._v("\n                  Post tasks\n                ")])])])])]):t._e(),t._v(" "),t.createdBatchId?e("div",{staticClass:"notification is-success"},[e("p",{staticClass:"mx-6 px-6 has-text-centered"},[e("strong",[t._v("Success!")]),e("br"),t._v("\n            Your order has been successfuly posted to\n            "),(t.env,e("a",{attrs:{href:"https://app.effect.network/campaigns/".concat(t.campaign.id,"/").concat(t.createdBatchId),target:"_blank",rel:"noopener noreferrer"}},[t._v("Effect Force")])),t._v(" "),e("br")]),e("hr"),t._v(" "),e("div",{staticClass:"buttons is-centered"},[e("a",{staticClass:"mx-6 px-6 button is-centered",attrs:{href:"/batch/"+t.createdBatchId,target:"",rel:"noopener noreferrer"}},[t._v("\n              Go to results\n            ")])])]):t._e()]):t._e(),t._v(" "),t.errorMessage?e("article",{staticClass:"message is-danger mt-5"},[e("div",{staticClass:"message-body"},[t._v("\n          "+t._s(t.errorMessage)+"\n        ")])]):t._e()])])])}),r,!1,null,null,null);e.default=component.exports},448:function(t,e,n){t.exports=n.p+"img/BSC-logo.187534e.svg"},449:function(t,e,n){t.exports=n.p+"img/EOS-logo.244ceb6.svg"},455:function(t,e){},457:function(t,e){},458:function(t,e){},462:function(t,e){},464:function(t,e){},471:function(t,e){},472:function(t,e){},482:function(t,e){},483:function(t,e){},489:function(t,e){},497:function(t,e){},498:function(t,e){},504:function(t,e){},506:function(t,e){},535:function(t,e){},537:function(t,e){},558:function(t,e){},575:function(t,e){}}]);